<!DOCTYPE html>

<html class='use-all-space'>
  <head>
      {% block head %}
      <title>My Map</title>
      <meta http-equiv='X-UA-Compatible' content='IE=Edge' />
      <meta charset='UTF-8'>
      <meta name='viewport'
            content='width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no'/>
      <!-- Replace version in the URL with desired library version -->
      <link rel='stylesheet' type='text/css' href='https://api.tomtom.com/maps-sdk-for-web/cdn/6.x/6.12.0/maps/maps.css'/>
      <!-- styles -->
      <style>
        #map {
          width: 500px;
          height: 500px;
        }
      </style>
      {% endblock %}
  </head>
  <body>
      <h1>Results</h1>
      <hr/>
      <p>distance = {{ distance }}</p>
      <p>path:</p>
      <div id='map' class='map'></div>
      <hr/>
      <a href="/">return</a>
      </div>
      <!-- scripts -->
      <!-- Replace version in the URL with desired library version -->
      <script src='https://api.tomtom.com/maps-sdk-for-web/cdn/6.x/6.12.0/maps/maps-web.min.js'></script>
      <script>
        tt.setProductInfo('interactiveMap', '1.0');

        var center_coordinate = ['{{ path[0][1] }}', '{{ path[0][0] }}'];

        var map = tt.map({
            key: 'o1geElO01tAzH56UIRG60l0g6cmtDWjz',
            container: 'map',
            center: center_coordinate,
            zoom: 4
        });

        var nodes = {{ nodes|tojson }};

        // set marker node
        for (i in nodes){
          var long = nodes[i][1];
          var lat = nodes[i][2];
          var name = nodes[i][0];
          var marker = new tt.Marker().setLngLat([lat, long]).addTo(map);
          var popupOffsets = {
            top: [0, 0],
            bottom: [0, -70],
            'bottom-right': [0, -70],
            'bottom-left': [0, -70],
            left: [25, -35],
            right: [-25, -35]
          };

          var popup = new tt.Popup({offset: popupOffsets}).setHTML(name);
          marker.setPopup(popup).togglePopup();
        }

        // set garis edge
        var edges = {{ edge_list|tojson }};
        // console.log(edges);
        map.on('load', function() {
          for (var i in edges){
              map.addLayer({
                'id': 'edge'+i,
                'type': 'line',
                'source': {
                    'type': 'geojson',
                    'data': {
                        'type': 'FeatureCollection',
                        'features': [
                            {
                                'type': 'Feature',
                                'geometry': {
                                  'type': 'LineString',
                                  'properties': {},
                                  'coordinates': [
                                    [edges[i][1], edges[i][0]],
                                    [edges[i][3], edges[i][2]]
                                  ]
                                },
                            }
                        ]
                    }
                },
                'layout': {
                  'line-cap': 'round',
                  'line-join': 'round'
                },
                'paint': {
                  'line-color': '#a1a1a1',
                  'line-width': 9
                }
              });
            }
          });

          // set garis path
          var path = {{ path|tojson }};
          map.on('load', function() {
          for (var i in path){
              map.addLayer({
                'id': 'path'+i,
                'type': 'line',
                'source': {
                    'type': 'geojson',
                    'data': {
                        'type': 'FeatureCollection',
                        'features': [
                            {
                                'type': 'Feature',
                                'geometry': {
                                  'type': 'LineString',
                                  'properties': {},
                                  'coordinates': [
                                    [path[i][1], path[i][0]],
                                    [path[i][3], path[i][2]]
                                  ]
                                },
                            }
                        ]
                    }
                },
                'layout': {
                  'line-cap': 'round',
                  'line-join': 'round'
                },
                'paint': {
                  'line-color': '#ff0000',
                  'line-width': 9
                }
              });
            }
          });
      </script>
  </body>
</html>